<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 시계열 분석1 | 텍스트 분석을 통한 프로듀스X101 데뷔조 예측</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 시계열 분석1 | 텍스트 분석을 통한 프로듀스X101 데뷔조 예측" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 시계열 분석1 | 텍스트 분석을 통한 프로듀스X101 데뷔조 예측" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="JDW" />


<meta name="date" content="2019-12-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="다중회귀분석.html"/>
<link rel="next" href="시계열-분석2.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NYSBNPQH3H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NYSBNPQH3H');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">텍스트 분석을 통한 프로듀스X101 데뷔조 예측</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Update</a></li>
<li class="chapter" data-level="1" data-path="prologue.html"><a href="prologue.html"><i class="fa fa-check"></i><b>1</b> Prologue</a></li>
<li class="chapter" data-level="2" data-path="데이터-수집.html"><a href="데이터-수집.html"><i class="fa fa-check"></i><b>2</b> 데이터 수집</a>
<ul>
<li class="chapter" data-level="2.1" data-path="데이터-수집.html"><a href="데이터-수집.html#웹-스크래핑"><i class="fa fa-check"></i><b>2.1</b> 웹 스크래핑</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="데이터-전처리.html"><a href="데이터-전처리.html"><i class="fa fa-check"></i><b>3</b> 데이터 전처리</a>
<ul>
<li class="chapter" data-level="3.1" data-path="데이터-전처리.html"><a href="데이터-전처리.html#데이터-취합"><i class="fa fa-check"></i><b>3.1</b> 데이터 취합</a></li>
<li class="chapter" data-level="3.2" data-path="데이터-전처리.html"><a href="데이터-전처리.html#feature-engineering"><i class="fa fa-check"></i><b>3.2</b> Feature Engineering</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="데이터-시각화.html"><a href="데이터-시각화.html"><i class="fa fa-check"></i><b>4</b> 데이터 시각화</a>
<ul>
<li class="chapter" data-level="4.1" data-path="데이터-시각화.html"><a href="데이터-시각화.html#회차별-게시글-수-비교"><i class="fa fa-check"></i><b>4.1</b> 회차별 게시글 수 비교</a></li>
<li class="chapter" data-level="4.2" data-path="데이터-시각화.html"><a href="데이터-시각화.html#요일별-게시글-수-비교"><i class="fa fa-check"></i><b>4.2</b> 요일별 게시글 수 비교</a></li>
<li class="chapter" data-level="4.3" data-path="데이터-시각화.html"><a href="데이터-시각화.html#일자별-게시글-수-비교"><i class="fa fa-check"></i><b>4.3</b> 일자별 게시글 수 비교</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="언급량-도출.html"><a href="언급량-도출.html"><i class="fa fa-check"></i><b>5</b> 언급량 도출</a>
<ul>
<li class="chapter" data-level="5.1" data-path="언급량-도출.html"><a href="언급량-도출.html#데이터-시각화-1"><i class="fa fa-check"></i><b>5.1</b> 데이터 시각화</a></li>
<li class="chapter" data-level="5.2" data-path="언급량-도출.html"><a href="언급량-도출.html#분석-범위-설정"><i class="fa fa-check"></i><b>5.2</b> 분석 범위 설정</a></li>
<li class="chapter" data-level="5.3" data-path="언급량-도출.html"><a href="언급량-도출.html#언급량-집계"><i class="fa fa-check"></i><b>5.3</b> 언급량 집계</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="언급량-도출.html"><a href="언급량-도출.html#별명-정리"><i class="fa fa-check"></i><b>5.3.1</b> 별명 정리</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="언급량-도출.html"><a href="언급량-도출.html#언급량-시각화"><i class="fa fa-check"></i><b>5.4</b> 언급량 시각화</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="언급량-도출.html"><a href="언급량-도출.html#barchart"><i class="fa fa-check"></i><b>5.4.1</b> Barchart</a></li>
<li class="chapter" data-level="5.4.2" data-path="언급량-도출.html"><a href="언급량-도출.html#에피소드별-언급량-변화"><i class="fa fa-check"></i><b>5.4.2</b> 에피소드별 언급량 변화</a></li>
<li class="chapter" data-level="5.4.3" data-path="언급량-도출.html"><a href="언급량-도출.html#barchart11화-언급량-기준-정렬"><i class="fa fa-check"></i><b>5.4.3</b> Barchart(11화 언급량 기준 정렬)</a></li>
<li class="chapter" data-level="5.4.4" data-path="언급량-도출.html"><a href="언급량-도출.html#bump-chart"><i class="fa fa-check"></i><b>5.4.4</b> Bump chart</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="모델링.html"><a href="모델링.html"><i class="fa fa-check"></i><b>6</b> 모델링</a>
<ul>
<li class="chapter" data-level="6.1" data-path="모델링.html"><a href="모델링.html#파일-불러오기-구조-확인"><i class="fa fa-check"></i><b>6.1</b> 파일 불러오기 &amp; 구조 확인</a></li>
<li class="chapter" data-level="6.2" data-path="모델링.html"><a href="모델링.html#예측-방식-설정"><i class="fa fa-check"></i><b>6.2</b> 예측 방식 설정</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="다중회귀분석.html"><a href="다중회귀분석.html"><i class="fa fa-check"></i><b>7</b> 다중회귀분석</a>
<ul>
<li class="chapter" data-level="7.1" data-path="다중회귀분석.html"><a href="다중회귀분석.html#데이터-분할"><i class="fa fa-check"></i><b>7.1</b> 데이터 분할</a></li>
<li class="chapter" data-level="7.2" data-path="다중회귀분석.html"><a href="다중회귀분석.html#모델-검정"><i class="fa fa-check"></i><b>7.2</b> 모델 검정</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="다중회귀분석.html"><a href="다중회귀분석.html#정규성"><i class="fa fa-check"></i><b>7.2.1</b> 정규성</a></li>
<li class="chapter" data-level="7.2.2" data-path="다중회귀분석.html"><a href="다중회귀분석.html#선형성"><i class="fa fa-check"></i><b>7.2.2</b> 선형성</a></li>
<li class="chapter" data-level="7.2.3" data-path="다중회귀분석.html"><a href="다중회귀분석.html#독립성"><i class="fa fa-check"></i><b>7.2.3</b> 독립성</a></li>
<li class="chapter" data-level="7.2.4" data-path="다중회귀분석.html"><a href="다중회귀분석.html#등분산성"><i class="fa fa-check"></i><b>7.2.4</b> 등분산성</a></li>
<li class="chapter" data-level="7.2.5" data-path="다중회귀분석.html"><a href="다중회귀분석.html#다중공선성"><i class="fa fa-check"></i><b>7.2.5</b> 다중공선성</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="다중회귀분석.html"><a href="다중회귀분석.html#결과"><i class="fa fa-check"></i><b>7.3</b> 결과</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="시계열-분석1.html"><a href="시계열-분석1.html"><i class="fa fa-check"></i><b>8</b> 시계열 분석1</a>
<ul>
<li class="chapter" data-level="8.1" data-path="시계열-분석1.html"><a href="시계열-분석1.html#ts객체"><i class="fa fa-check"></i><b>8.1</b> <code>ts</code>객체</a></li>
<li class="chapter" data-level="8.2" data-path="시계열-분석1.html"><a href="시계열-분석1.html#모델링-1"><i class="fa fa-check"></i><b>8.2</b> 모델링</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="시계열-분석1.html"><a href="시계열-분석1.html#시계열-회귀-모델"><i class="fa fa-check"></i><b>8.2.1</b> 시계열 회귀 모델</a></li>
<li class="chapter" data-level="8.2.2" data-path="시계열-분석1.html"><a href="시계열-분석1.html#ets"><i class="fa fa-check"></i><b>8.2.2</b> ETS</a></li>
<li class="chapter" data-level="8.2.3" data-path="시계열-분석1.html"><a href="시계열-분석1.html#arima"><i class="fa fa-check"></i><b>8.2.3</b> ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="시계열-분석1.html"><a href="시계열-분석1.html#모델-평가"><i class="fa fa-check"></i><b>8.3</b> 모델 평가</a></li>
<li class="chapter" data-level="8.4" data-path="시계열-분석1.html"><a href="시계열-분석1.html#시계열-교차-검증"><i class="fa fa-check"></i><b>8.4</b> 시계열 교차 검증</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="시계열-분석1.html"><a href="시계열-분석1.html#교차검증-함수-생성"><i class="fa fa-check"></i><b>8.4.1</b> 교차검증 함수 생성</a></li>
<li class="chapter" data-level="8.4.2" data-path="시계열-분석1.html"><a href="시계열-분석1.html#최종-모델링"><i class="fa fa-check"></i><b>8.4.2</b> 최종 모델링</a></li>
<li class="chapter" data-level="8.4.3" data-path="시계열-분석1.html"><a href="시계열-분석1.html#잔차-검정"><i class="fa fa-check"></i><b>8.4.3</b> 잔차 검정</a></li>
<li class="chapter" data-level="8.4.4" data-path="시계열-분석1.html"><a href="시계열-분석1.html#예측"><i class="fa fa-check"></i><b>8.4.4</b> 예측</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="시계열-분석2.html"><a href="시계열-분석2.html"><i class="fa fa-check"></i><b>9</b> 시계열 분석2</a>
<ul>
<li class="chapter" data-level="9.1" data-path="시계열-분석2.html"><a href="시계열-분석2.html#연습생별-모델링-함수-생성"><i class="fa fa-check"></i><b>9.1</b> 연습생별 모델링 함수 생성</a></li>
<li class="chapter" data-level="9.2" data-path="시계열-분석2.html"><a href="시계열-분석2.html#사용-모델-확인"><i class="fa fa-check"></i><b>9.2</b> 사용 모델 확인</a></li>
<li class="chapter" data-level="9.3" data-path="시계열-분석2.html"><a href="시계열-분석2.html#모델-시각화"><i class="fa fa-check"></i><b>9.3</b> 모델 시각화</a></li>
<li class="chapter" data-level="9.4" data-path="시계열-분석2.html"><a href="시계열-분석2.html#결론"><i class="fa fa-check"></i><b>9.4</b> 결론</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">텍스트 분석을 통한 프로듀스X101 데뷔조 예측</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="시계열-분석1" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> 시계열 분석1</h1>
<p> 기후나 주가지수와 같이 시간에 따라 관찰된 값들을 분석하는 경우 시계열분석 기법을 사용합니다. 과거의 값들을 토대로 미래의 값을 추정하거나 패턴들의 특징을 파악하기 위해 분석하는 기법입니다. 이전에 일간별로 수집한 데이터들을 전처리하여 연습생별 언급량을 계산하는 과정을 진행하였었는데 오늘은 이 데이터를 활용, 각 연습생별 적절한 모델을 찾고 해당 모델을 토대로 예측값을 도출하여 이를 비교하는 과정을 진행하겠습니다.</p>
<div id="ts객체" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> <code>ts</code>객체</h2>
<p> time-series의 약자인 <code>ts</code>객체는 이름에 나와있는 것처럼 시계열분석을 위해 사용되는 객체 중 하나입니다. 시간의 흐름에 따라 연속적인 속성을 지닌 변수에 <code>ts()</code>함수를 적용하여 생성할 수 있으며, 시계열에 존재하는 주기를 <code>frequency</code> 옵션을 사용하여 지정할 수 있는것이 특징입니다. 이전장에서 사용한 <code>total</code>변수를 사용하여 연습생들의 언급량의 총 합을 계산하여 이를 ts객체로 생성해 보겠습니다.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="시계열-분석1.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-2"><a href="시계열-분석1.html#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="시계열-분석1.html#cb88-3" aria-hidden="true" tabindex="-1"></a>ts_mention <span class="ot">&lt;-</span> total <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="시계열-분석1.html#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(p_ymd) <span class="sc">%&gt;%</span> </span>
<span id="cb88-5"><a href="시계열-분석1.html#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">sum_mention =</span> sum_mention <span class="sc">%&gt;%</span> <span class="fu">sum</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb88-6"><a href="시계열-분석1.html#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb88-7"><a href="시계열-분석1.html#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="시계열-분석1.html#cb88-8" aria-hidden="true" tabindex="-1"></a>ts_mention</span></code></pre></div>
<pre><code>## Time Series:
## Start = c(1, 1) 
## End = c(7, 7) 
## Frequency = 7 
##          p_ymd sum_mention
## 1.000000 18048       16441
## 1.142857 18049        7624
## 1.285714 18050       10450
## 1.428571 18051        6213
## 1.571429 18052        6596
## 1.714286 18053        7046
## 1.857143 18054        7027
## 2.000000 18055       13243
## 2.142857 18056        7902
## 2.285714 18057        7904
## 2.428571 18058       11147
## 2.571429 18059        8051
## 2.714286 18060        7396
## 2.857143 18061        8489
## 3.000000 18062       19602
## 3.142857 18063       10050
## 3.285714 18064       10682
## 3.428571 18065        6534
## 3.571429 18066        6582
## 3.714286 18067        6531
## 3.857143 18068       11108
## 4.000000 18069       19281
## 4.142857 18070       10440
## 4.285714 18071        9554
## 4.428571 18072        6465
## 4.571429 18073        6286
## 4.714286 18074        6051
## 4.857143 18075       11791
## 5.000000 18076       24992
## 5.142857 18077       14246
## 5.285714 18078       12820
## 5.428571 18079       11127
## 5.571429 18080        8714
## 5.714286 18081       13161
## 5.857143 18082       16611
## 6.000000 18083       26408
## 6.142857 18084       14017
## 6.285714 18085       12060
## 6.428571 18086       15208
## 6.571429 18087       11365
## 6.714286 18088       18463
## 6.857143 18089       18618
## 7.000000 18090       34965
## 7.142857 18091       15609
## 7.285714 18092       13102
## 7.428571 18093       14000
## 7.571429 18094       11601
## 7.714286 18095       13098
## 7.857143 18096       21905</code></pre>
</div>
<div id="모델링-1" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> 모델링</h2>
<div id="시계열-회귀-모델" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> 시계열 회귀 모델</h3>
<p> <code>forecast</code>패키지에 포함되어 있는 <code>tslm()</code> 함수는 시계열 회귀분석을 하는데 용이한 함수입니다. 일반적으로 <code>lm()</code>함수와 동일한 기능을 수행하지만 시계열 데이터가 보유하고 있는 계절성과 추세를 자동으로 계산하여 각각 <code>season</code>, <code>trend</code> 변수로 치환하고, 이를 회귀분석에 사용할 수 있도록 해줍니다.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="시계열-분석1.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb90-2"><a href="시계열-분석1.html#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="시계열-분석1.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tslm 모델 생성 </span></span>
<span id="cb90-4"><a href="시계열-분석1.html#cb90-4" aria-hidden="true" tabindex="-1"></a>mod_tslm <span class="ot">&lt;-</span> <span class="fu">tslm</span>(sum_mention <span class="sc">~</span> trend <span class="sc">+</span> season, <span class="at">data =</span> ts_mention)</span>
<span id="cb90-5"><a href="시계열-분석1.html#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="시계열-분석1.html#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델 결과 </span></span>
<span id="cb90-7"><a href="시계열-분석1.html#cb90-7" aria-hidden="true" tabindex="-1"></a>mod_tslm <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## tslm(formula = sum_mention ~ trend + season, data = ts_mention)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5591.7 -1803.1  -389.8  1262.4  7884.2 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  16949.91    1184.11  14.314  &lt; 2e-16 ***
## trend          235.60      27.49   8.572 1.10e-10 ***
## season2     -10956.17    1440.04  -7.608 2.31e-09 ***
## season3     -11665.49    1440.83  -8.096 4.89e-10 ***
## season4     -12740.80    1442.14  -8.835 4.89e-11 ***
## season5     -14619.12    1443.97 -10.124 1.02e-12 ***
## season6     -13061.72    1446.32  -9.031 2.68e-11 ***
## season7      -9896.89    1449.19  -6.829 2.87e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2694 on 41 degrees of freedom
## Multiple R-squared:  0.8255, Adjusted R-squared:  0.7957 
## F-statistic: 27.71 on 7 and 41 DF,  p-value: 1.275e-13</code></pre>
<p> 생성된 모델의 결과를 살펴보면 자동으로 추세변수와 계절성 변수를 계산하여 이를통해 회귀식을 생성한 것을 볼 수 있습니다. 이렇게 생성된 모델을 <code>forecast()</code>함수를 통해 미래의 예측값을 도출해 낼 수 있습니다.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="시계열-분석1.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예측값 도출 </span></span>
<span id="cb92-2"><a href="시계열-분석1.html#cb92-2" aria-hidden="true" tabindex="-1"></a>mod_tslm_pred <span class="ot">&lt;-</span> mod_tslm <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb92-3"><a href="시계열-분석1.html#cb92-3" aria-hidden="true" tabindex="-1"></a>mod_tslm_pred</span></code></pre></div>
<pre><code>##          Point Forecast    Lo 80    Hi 80     Lo 95    Hi 95
## 8.000000       28729.98 24847.59 32612.37 22710.491 34749.47
## 8.142857       18009.41 14127.02 21891.80 11989.920 24028.90
## 8.285714       17535.69 13653.30 21418.08 11516.205 23555.18
## 8.428571       16695.98 12813.59 20578.37 10676.491 22715.47
## 8.571429       15053.27 11170.88 18935.65  9033.777 21072.75
## 8.714286       16846.27 12963.88 20728.65 10826.777 22865.75
## 8.857143       20246.69 16364.30 24129.08 14227.205 26266.18</code></pre>
<p> 모델을 통한 예측값의 점추정 값과 신뢰구간을 계산해 줌을 볼 수 있습니다. 이렇게 계산된 예측값을 시각화하여 볼 수 있습니다.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="시계열-분석1.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 예측값 시각화 </span></span>
<span id="cb94-2"><a href="시계열-분석1.html#cb94-2" aria-hidden="true" tabindex="-1"></a>mod_tslm_pred <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="bookdown_sample_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<p> 최종적으로 모델을 사용하기 이전에 모델의 성능을 측정하여 해당 모델이 다른 모델에 비해 성능적으로 우위가 있는지를 판단할 수 있습니다. 모델의 성능을 측정하는 방법에는 다양한 방법들이 존재합니다. 함수 <code>accuracy()</code>를 사용하면 주요 성능을 계산하여 보여줌으로서 모델의 성능을 파악하는데 용이합니다.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="시계열-분석1.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델 정확성 </span></span>
<span id="cb95-2"><a href="시계열-분석1.html#cb95-2" aria-hidden="true" tabindex="-1"></a>mod_tslm_pred <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span></code></pre></div>
<pre><code>##                         ME     RMSE      MAE       MPE     MAPE      MASE      ACF1
## Training set -1.949778e-13 2463.901 1914.331 -2.689877 17.70896 0.7446207 0.3114162</code></pre>
</div>
<div id="ets" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> ETS</h3>
<p> 지수평활법(Exponential Smoothing)은 과거 시점의 값들을 지수적으로 감쇠시키는 가중치를 부여, 그 과정에서 시계열 데이터가 지니고 있는 추세적 특징과 계절성을 함께 사용하여 미래값을 추정하는 방식입니다. <code>ets()</code>함수를 통해 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="시계열-분석1.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS 모델 생성 </span></span>
<span id="cb97-2"><a href="시계열-분석1.html#cb97-2" aria-hidden="true" tabindex="-1"></a>mod_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(ts_mention[, <span class="st">&#39;sum_mention&#39;</span>])</span>
<span id="cb97-3"><a href="시계열-분석1.html#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="시계열-분석1.html#cb97-4" aria-hidden="true" tabindex="-1"></a>mod_ets</span></code></pre></div>
<pre><code>## ETS(M,N,M) 
## 
## Call:
##  ets(y = ts_mention[, &quot;sum_mention&quot;]) 
## 
##   Smoothing parameters:
##     alpha = 0.4791 
##     gamma = 3e-04 
## 
##   Initial states:
##     l = 10157.3035 
##     s = 1.0528 0.785 0.66 0.8397 0.895 0.9398
##            1.8278
## 
##   sigma:  0.2171
## 
##      AIC     AICc      BIC 
## 963.9526 969.7421 982.8708</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="시계열-분석1.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS 모델 예측값</span></span>
<span id="cb99-2"><a href="시계열-분석1.html#cb99-2" aria-hidden="true" tabindex="-1"></a>mod_ets_pred <span class="ot">&lt;-</span> mod_ets <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb99-3"><a href="시계열-분석1.html#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="시계열-분석1.html#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS 모델 예측값 시각화 </span></span>
<span id="cb99-5"><a href="시계열-분석1.html#cb99-5" aria-hidden="true" tabindex="-1"></a>mod_ets_pred <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="bookdown_sample_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="시계열-분석1.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS 모델 성능 </span></span>
<span id="cb100-2"><a href="시계열-분석1.html#cb100-2" aria-hidden="true" tabindex="-1"></a>mod_ets_pred <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span></code></pre></div>
<pre><code>##                    ME     RMSE      MAE         MPE     MAPE     MASE      ACF1
## Training set 366.2466 2238.365 1732.237 -0.02427324 14.99357 0.673791 0.1015756</code></pre>
</div>
<div id="arima" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> ARIMA</h3>
<p> 시계열 데이터의 자기회귀성을 통해 미래값을 추정하는 arima 모델을 사용하여 미래값을 추정할 수 있습니다. arima 모델은 평균과 분산이 일정한 정상성의 성격을 가진 시계열 데이터를 자기회귀모델(Auto-Regressive model)과 이동평균모델(Moving Average model)을 결합한 모델로서 각각 특정 과거시점까지의 계수의 자기상관성과 오차의 자기상관성을 하나의 모델로서 구현한 것입니다. 본래 arima 모델을 구하기 위해서는 먼저 차분을 통한 시계열의 정상성 확보 이후 ACF와 PACF를 통한 적절한 AR 차수와 MA 차수를 구하는 과정이 필요하지만 R에서 제공하는 <code>auto.arima()</code>함수는 (AICc값의 최소로 하는 모델을 찾아) 최적의 arima 모델을 찾아 반환하여 줍니다.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="시계열-분석1.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arima 모델 생성 </span></span>
<span id="cb102-2"><a href="시계열-분석1.html#cb102-2" aria-hidden="true" tabindex="-1"></a>mod_arima <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_mention[, <span class="st">&#39;sum_mention&#39;</span>], <span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-3"><a href="시계열-분석1.html#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="시계열-분석1.html#cb102-4" aria-hidden="true" tabindex="-1"></a>mod_arima</span></code></pre></div>
<pre><code>## Series: ts_mention[, &quot;sum_mention&quot;] 
## ARIMA(0,0,2)(1,1,0)[7] with drift 
## 
## Coefficients:
##          ma1     ma2     sar1     drift
##       0.3016  0.4263  -0.4444  224.0282
## s.e.  0.1509  0.1442   0.1681   68.6841
## 
## sigma^2 estimated as 6908166:  log likelihood=-389.24
## AIC=788.49   AICc=790.15   BIC=797.18</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="시계열-분석1.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arima 모델 예측값</span></span>
<span id="cb104-2"><a href="시계열-분석1.html#cb104-2" aria-hidden="true" tabindex="-1"></a>mod_arima_pred <span class="ot">&lt;-</span> mod_arima <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb104-3"><a href="시계열-분석1.html#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="시계열-분석1.html#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># arima 모델 예측값 시각화 </span></span>
<span id="cb104-5"><a href="시계열-분석1.html#cb104-5" aria-hidden="true" tabindex="-1"></a>mod_arima_pred <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="bookdown_sample_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="시계열-분석1.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arima 모델 성능 </span></span>
<span id="cb105-2"><a href="시계열-분석1.html#cb105-2" aria-hidden="true" tabindex="-1"></a>mod_arima_pred <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span></code></pre></div>
<pre><code>##                     ME     RMSE      MAE    MPE     MAPE     MASE       ACF1
## Training set -28.30705 2314.596 1719.968 -4.203 14.63408 0.669019 -0.0157034</code></pre>
</div>
</div>
<div id="모델-평가" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> 모델 평가</h2>
<p>  <code>accuracy()</code>함수를 통해 계산한 모델들의 성능을 대조해 봄으로서 각 모델들의 성능을 한눈에 파악하고, 최적의 퍼포먼스를 보여주는 모델을 파악하여 최종 사용 모델로 선정할 수 있습니다. 생성한 모델들의 성능을 하나의 데이터 프레임으로 묶어 지표 기준으로 재정렬하는 과정을 진행합니다.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="시계열-분석1.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델별 정확도 변수 생성  </span></span>
<span id="cb107-2"><a href="시계열-분석1.html#cb107-2" aria-hidden="true" tabindex="-1"></a>mod_tslm_accuracy  <span class="ot">&lt;-</span> mod_tslm <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span>
<span id="cb107-3"><a href="시계열-분석1.html#cb107-3" aria-hidden="true" tabindex="-1"></a>mod_ets_accuracy   <span class="ot">&lt;-</span> mod_ets <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span>
<span id="cb107-4"><a href="시계열-분석1.html#cb107-4" aria-hidden="true" tabindex="-1"></a>mod_arima_accuracy <span class="ot">&lt;-</span> mod_arima <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>()</span>
<span id="cb107-5"><a href="시계열-분석1.html#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="시계열-분석1.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델 정확도 이름 지정</span></span>
<span id="cb107-7"><a href="시계열-분석1.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(mod_tslm_accuracy)[[<span class="dv">1</span>]]  <span class="ot">&lt;-</span> <span class="st">&#39;mod_tslm&#39;</span></span>
<span id="cb107-8"><a href="시계열-분석1.html#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(mod_ets_accuracy)[[<span class="dv">1</span>]]   <span class="ot">&lt;-</span> <span class="st">&#39;mod_ets&#39;</span></span>
<span id="cb107-9"><a href="시계열-분석1.html#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(mod_arima_accuracy)[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">&#39;mod_arima&#39;</span></span>
<span id="cb107-10"><a href="시계열-분석1.html#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="시계열-분석1.html#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE 기준 정렬 </span></span>
<span id="cb107-12"><a href="시계열-분석1.html#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(mod_tslm_accuracy, mod_ets_accuracy, mod_arima_accuracy) <span class="sc">%&gt;%</span> </span>
<span id="cb107-13"><a href="시계열-분석1.html#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-14"><a href="시계열-분석1.html#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(RMSE)</span></code></pre></div>
<pre><code>##                      ME     RMSE      MAE         MPE     MAPE      MASE       ACF1
## mod_ets    3.662466e+02 2238.365 1732.237 -0.02427324 14.99357 0.6737910  0.1015756
## mod_arima -2.830705e+01 2314.596 1719.968 -4.20300032 14.63408 0.6690190 -0.0157034
## mod_tslm  -1.949778e-13 2463.901 1914.331 -2.68987699 17.70896 0.7446207  0.3114162</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="시계열-분석1.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAPE 기준 정렬 </span></span>
<span id="cb109-2"><a href="시계열-분석1.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(mod_tslm_accuracy, mod_ets_accuracy, mod_arima_accuracy) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="시계열-분석1.html#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="시계열-분석1.html#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(MAPE)</span></code></pre></div>
<pre><code>##                      ME     RMSE      MAE         MPE     MAPE      MASE       ACF1
## mod_arima -2.830705e+01 2314.596 1719.968 -4.20300032 14.63408 0.6690190 -0.0157034
## mod_ets    3.662466e+02 2238.365 1732.237 -0.02427324 14.99357 0.6737910  0.1015756
## mod_tslm  -1.949778e-13 2463.901 1914.331 -2.68987699 17.70896 0.7446207  0.3114162</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="시계열-분석1.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF1(1시차 자기상관성) 기준 정렬 </span></span>
<span id="cb111-2"><a href="시계열-분석1.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(mod_tslm_accuracy, mod_ets_accuracy, mod_arima_accuracy) <span class="sc">%&gt;%</span> </span>
<span id="cb111-3"><a href="시계열-분석1.html#cb111-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="시계열-분석1.html#cb111-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(ACF1)</span></code></pre></div>
<pre><code>##                      ME     RMSE      MAE         MPE     MAPE      MASE       ACF1
## mod_arima -2.830705e+01 2314.596 1719.968 -4.20300032 14.63408 0.6690190 -0.0157034
## mod_ets    3.662466e+02 2238.365 1732.237 -0.02427324 14.99357 0.6737910  0.1015756
## mod_tslm  -1.949778e-13 2463.901 1914.331 -2.68987699 17.70896 0.7446207  0.3114162</code></pre>
<p> 거의 모든 지표에서 arima 모델이 우위에 있는것으로 나오나 RMSE에서만은 ets 모델이 근소하게 우위에 있는것을 확인할 수 있습니다.</p>
</div>
<div id="시계열-교차-검증" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> 시계열 교차 검증</h2>
<p><img src="img_source/producex8/tscv.png" width="100%" style="display: block; margin: auto;" /></p>
<p> 단일 데이터에 대한 모델링은 모델이 데이터의 특성을 지나치게 학습하여 일반화된 예측에서 성능이 되려 떨어지게 되는 과적합의 위험성이 있습니다. 모델의 과적합을 방지하기 위해 데이터의 부분추출을 통한 학습을 여러번 수행하고, 각 학습마다의 성능을 측정하여 그 성능값을 평균내는 방식의 교차검증을 통해 과적합의 위험성을 방지할 수 있습니다.</p>
<p> 시계열 데이터에서의 교차검정은 <code>tsCV()</code>함수를 통해 수행할 수 있습니다. <code>tsCV()</code>함수는 특정 과거시점 까지의 데이터를 학습하고 누적 순차적으로 최신 데이터까지의 학습을 수행하는데 output으로 모델의 잔차를 반환하여 줍니다. 해당 잔차를 통해 각 모델별 성능을 계산하여 비교를 진행, 최적의 모델을 선택하여 사용할 수 있습니다.</p>
<div id="교차검증-함수-생성" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> 교차검증 함수 생성</h3>
<p>  <code>tsCV()</code>의 인수로 시계열 모델링을 수행할 함수를 지정하는 과정이 필요합니다. 시계열 교차검증에 적합한 모델 함수를 생성하도록 하겠습니다.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="시계열-분석1.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 시계열 교차검증용 모델 생성 </span></span>
<span id="cb113-2"><a href="시계열-분석1.html#cb113-2" aria-hidden="true" tabindex="-1"></a>forecast_arima <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h){</span>
<span id="cb113-3"><a href="시계열-분석1.html#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">auto.arima</span>(x, <span class="at">stepwise =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> h)</span>
<span id="cb113-4"><a href="시계열-분석1.html#cb113-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-5"><a href="시계열-분석1.html#cb113-5" aria-hidden="true" tabindex="-1"></a>forecast_tslm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h){</span>
<span id="cb113-6"><a href="시계열-분석1.html#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tslm</span>(x <span class="sc">~</span> trend <span class="sc">+</span> season, <span class="at">data =</span> x) <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> h)</span>
<span id="cb113-7"><a href="시계열-분석1.html#cb113-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-8"><a href="시계열-분석1.html#cb113-8" aria-hidden="true" tabindex="-1"></a>forecast_ets <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h){</span>
<span id="cb113-9"><a href="시계열-분석1.html#cb113-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ets</span>(x) <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> h)</span>
<span id="cb113-10"><a href="시계열-분석1.html#cb113-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-11"><a href="시계열-분석1.html#cb113-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-12"><a href="시계열-분석1.html#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 교차검증 잔차 </span></span>
<span id="cb113-13"><a href="시계열-분석1.html#cb113-13" aria-hidden="true" tabindex="-1"></a>tslm_cv_residual  <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_mention[, <span class="st">&#39;sum_mention&#39;</span>], forecast_tslm, <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb113-14"><a href="시계열-분석1.html#cb113-14" aria-hidden="true" tabindex="-1"></a>ets_cv_residual   <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_mention[, <span class="st">&#39;sum_mention&#39;</span>], forecast_ets, <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb113-15"><a href="시계열-분석1.html#cb113-15" aria-hidden="true" tabindex="-1"></a>arima_cv_residual <span class="ot">&lt;-</span> <span class="fu">tsCV</span>(ts_mention[, <span class="st">&#39;sum_mention&#39;</span>], forecast_arima, <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb113-16"><a href="시계열-분석1.html#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="시계열-분석1.html#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 모델 평가 매트릭 함수 생성(RMSE)</span></span>
<span id="cb113-18"><a href="시계열-분석1.html#cb113-18" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(res){</span>
<span id="cb113-19"><a href="시계열-분석1.html#cb113-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(res<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb113-20"><a href="시계열-분석1.html#cb113-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-21"><a href="시계열-분석1.html#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="시계열-분석1.html#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb113-23"><a href="시계열-분석1.html#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">tslm  =</span> tslm_cv_residual <span class="sc">%&gt;%</span> <span class="fu">RMSE</span>(),</span>
<span id="cb113-24"><a href="시계열-분석1.html#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">ets   =</span> ets_cv_residual <span class="sc">%&gt;%</span> <span class="fu">RMSE</span>(), </span>
<span id="cb113-25"><a href="시계열-분석1.html#cb113-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">arima =</span> arima_cv_residual <span class="sc">%&gt;%</span> <span class="fu">RMSE</span>()</span>
<span id="cb113-26"><a href="시계열-분석1.html#cb113-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##      tslm      ets    arima
## 1 3453.27 3621.207 3845.548</code></pre>
<p> 모델별 교차검증 결과로 나온 잔차에 RMSE를 기준으로 계산한 결과 시계열 회귀 모델(tslm)의 성능이 상대적으로 우수한 것으로 판별이 되었습니다.</p>
</div>
<div id="최종-모델링" class="section level3" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> 최종 모델링</h3>
<p> 교차검증 모델 평가를 통해 시계열 회귀 모델을 사용하는 것이 괜찮다고 나왔으므로 이전에 생성한 시계열 회귀 모델을 최종 모델로 선정하겠습니다.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="시계열-분석1.html#cb115-1" aria-hidden="true" tabindex="-1"></a>mod_tslm <span class="ot">&lt;-</span> <span class="fu">tslm</span>(sum_mention <span class="sc">~</span> trend <span class="sc">+</span> season, <span class="at">data =</span> ts_mention)</span></code></pre></div>
</div>
<div id="잔차-검정" class="section level3" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> 잔차 검정</h3>
<p> 마지막으로 시계열 모델의 잔차가 백색잡음을 띄는지를 검정하도록 하겠습니다. 만약 잔차에 패턴 혹은 상관성이 존재할 경우 모델이 이는 회귀모델의 독립성 가정에 위배되므로 잘못된 모델이라고 할 수 있습니다.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="시계열-분석1.html#cb116-1" aria-hidden="true" tabindex="-1"></a>mod_tslm <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>()</span></code></pre></div>
<p><img src="bookdown_sample_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 11
## 
## data:  Residuals from Linear regression model
## LM test = 12.45, df = 11, p-value = 0.3308</code></pre>
<p>  생성된 그래프의 잔차분포는 조금은 치우쳐 있지만 정규분포의 형태와 흡사해 보이고 acf역시 크게 이상은 없어보입니다. <code>checkresiduals()</code>함수는 모델이 회귀분석 모델이면 Breusch-Godfrey test를, 그렇지 않으면 Ljung-Box test를 진행합니다. 두 검정법 모두 귀무가설로 잔차의 상관성이 통계적으로 유의성이 존재하지 않는다 정의하고 있습니다.(백색잡음이라 보여짐) <code>checkresiduals()</code>함수의 결과로 p_value &gt; 0.05 인 것을 보아 모델의 잔차에는 이상이 없어 보입니다.</p>
</div>
<div id="예측" class="section level3" number="8.4.4">
<h3><span class="header-section-number">8.4.4</span> 예측</h3>
<p> 잔차검정까지 마친 모델을 대상으로 미래 시점의 값을 추정해 볼 수 있습니다. 앞서 사용한 <code>forecast()</code>함수를 통해 시계열 회귀 모델의 미래 추정값을 계산하고, 이에대한 신뢰구간을 계산하여 파악할 수 있습니다.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="시계열-분석1.html#cb118-1" aria-hidden="true" tabindex="-1"></a>mod_tslm <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">7</span>)</span></code></pre></div>
<pre><code>##          Point Forecast    Lo 80    Hi 80     Lo 95    Hi 95
## 8.000000       28729.98 24847.59 32612.37 22710.491 34749.47
## 8.142857       18009.41 14127.02 21891.80 11989.920 24028.90
## 8.285714       17535.69 13653.30 21418.08 11516.205 23555.18
## 8.428571       16695.98 12813.59 20578.37 10676.491 22715.47
## 8.571429       15053.27 11170.88 18935.65  9033.777 21072.75
## 8.714286       16846.27 12963.88 20728.65 10826.777 22865.75
## 8.857143       20246.69 16364.30 24129.08 14227.205 26266.18</code></pre>
<p> 모델을 생성하는데 사용된 총 언급량 데이터와 이를 시계열 회귀모델에 적합한 값 그리고 회귀모델의 예측값까지 시각화하여 확인할 수 있습니다. <code>ggplot2</code> 문법을 따르는 <code>autoplot()</code>함수를 통해 시계열 시각화를 수월하게 할 수 있습니다.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="시계열-분석1.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb120-2"><a href="시계열-분석1.html#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="시계열-분석1.html#cb120-3" aria-hidden="true" tabindex="-1"></a>ts_mention[, <span class="st">&#39;sum_mention&#39;</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb120-4"><a href="시계열-분석1.html#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(<span class="at">series =</span> <span class="st">&#39;Original&#39;</span>) <span class="sc">+</span>  </span>
<span id="cb120-5"><a href="시계열-분석1.html#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autolayer</span>(<span class="fu">fitted</span>(mod_tslm), <span class="at">series =</span> <span class="st">&#39;tslm_fitted&#39;</span>) <span class="sc">+</span> </span>
<span id="cb120-6"><a href="시계열-분석1.html#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autolayer</span>(<span class="fu">forecast</span>(mod_tslm), <span class="at">h =</span> <span class="dv">7</span>, <span class="at">series =</span> <span class="st">&#39;tslm_forecast&#39;</span>) <span class="sc">+</span> </span>
<span id="cb120-7"><a href="시계열-분석1.html#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Original&#39;</span> <span class="ot">=</span> <span class="st">&#39;black&#39;</span>, <span class="st">&#39;tslm_fitted&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>, <span class="st">&#39;tslm_forecast&#39;</span> <span class="ot">=</span> <span class="st">&#39;blue&#39;</span>),</span>
<span id="cb120-8"><a href="시계열-분석1.html#cb120-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&#39;Original&#39;</span>, <span class="st">&#39;tslm_fitted&#39;</span>, <span class="st">&#39;tslm_forecast&#39;</span>))</span></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: h</code></pre>
<p><img src="bookdown_sample_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p> 위의 과정을 통해 검정선의 실제 데이터(총 언급량)과 붉은선의 모델에 적합한 값을 비교하여 볼 수 있고, 파란 음영처리된 신뢰구간을 포함한 미래 예측값을 하나의 그래프로 표현하여 한 눈에 볼 수 있습니다.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="다중회귀분석.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="시계열-분석2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown_sample.pdf", "bookdown_sample.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
